name: Units tests
on: [push, pull_request]
jobs:
  checks:
    name: test
    runs-on: ubuntu-latest
    strategy:
      matrix: 
        go-version: ['1.19', '1.20', '1.21', '1.22', '1.23', '1.24', '1.25']
    steps:
      - uses: actions/checkout@v4.2.2
        name: Checkout Repository
      - name: Setup go
        uses: actions/setup-go@v6
        with:
          go-version: ${{ matrix.go-version }}
      - run: |
          sudo apt-get update -qq
          sudo apt-get install proftpd-basic
          sudo useradd -m -d /home/ftp-test ftp-test
          echo "ftp-test:ftp-test" | sudo chpasswd
          sudo cp .github/proftpd.conf /etc/proftpd/conf.d/ftp-test.conf
          sudo systemctl start proftpd
        name: Setup ProFTPd
      - name: Run tests
        run: go test -v -covermode=count -coverprofile=coverage.out
      - name: Convert coverage to lcov
        uses: jandelgado/gcov2lcov-action@4e1989767862652e6ca8d3e2e61aabe6d43be28b
      - name: Coveralls
        uses: coverallsapp/github-action@648a8eb78e6d50909eff900e4ec85cab4524a45b
        with:
          github-token: ${{ secrets.github_token }}
          path-to-lcov: coverage.lcov
